buildscript {
	ext.kotlin_version = '1.7.10'
	repositories {
		mavenCentral()
	}
}
plugins {
	id 'maven-publish'
	id "java"
	id 'signing'
	id 'idea'
}

apply plugin: GenerateConfigPlugin.class

subprojects {
	task javadocJar(type: Jar) {	
		 classifier = 'javadoc'	
		 from javadoc
	}
	task sourcesJar(type: Jar) {	
		 classifier = 'sources'	
		 from sourceSets.main.allSource
	}

	publishing {
		publications {
			mavenJava(MavenPublication) {
				pom {
					name = 'My Library'
					description = 'A concise description of my library'
					url = 'http://www.example.com/library'
					properties = [
							myProp: "value",
							"prop.with.dots": "anotherValue"
					]
					licenses {
						license {
							name = 'The Apache License, Version 2.0'
							url = 'http://www.apache.org/licenses/LICENSE-2.0.txt'
						}
					}
					developers {
						developer {
							id = 'johnd'
							name = 'John Doe'
							email = 'john.doe@example.com'
						}
					}
					scm {
						connection = 'scm:git:git://example.com/my-library.git'
						developerConnection = 'scm:git:ssh://example.com/my-library.git'
						url = 'http://example.com/my-library/'
					}
				}
			}
		}

		repositories {
			maven {
				def releasesRepoUrl = 'https://oss.sonatype.org/service/local/staging/deploy/maven2/'
				def snapshotsRepoUrl = "https://oss.sonatype.org/content/repositories/snapshots/"
				url = version.endsWith('SNAPSHOT') ? snapshotsRepoUrl : releasesRepoUrl
				credentials {
					username = ossrhUsername
					password = ossrhPassword
				}
			}
		}
	}
}

//https://docs.gradle.org/current/userguide/signing_plugin.html
signing {
	sign publishing.publications.mavenJava
}

idea {
	module {
		downloadJavadoc = true
		downloadSources = true
	}
}
